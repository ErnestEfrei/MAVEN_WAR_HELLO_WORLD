pipeline{
    agent any
    tools {
      maven 'MVN_HOME'
    }

    environment {
        DOCKER_HUB_CREDENTIALS = credentials('docker-hub-pass')
    }

stages{
    stage('Maven Build') {
        steps {
            echo 'Trigger a maven build'
            sh "mvn clean package"
        }
    }
       
    stage('Docker Build'){
        steps{
            echo 'Build ernestefrei/devopsproject'
            sh "docker build -t ernestefrei/devopsproject . "
        }
    }
        
    stage('DockerHub Push'){
        steps{
            echo 'Login to Docker-Hub with docker-hub-pass credentials'
            sh "sudo docker login -u ${DOCKER_HUB_CREDENTIALS_USR} -p ${DOCKER_HUB_CREDENTIALS_PSW}"

            echo 'Push Docker image to Docker Hub'
            sh "docker push ernestefrei/devopsproject:latest"
        }
    }
  
    stage('Docker Deploy'){
            steps{
                echo 'Deploy Docker'
                ansiblePlaybook credentialsId: 'ansible', inventory: 'dev.inv', playbook: 'deploy-docker.yml'
        }        
    }
    
}
}
