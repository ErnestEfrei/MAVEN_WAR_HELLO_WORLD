pipeline{
    agent any
    tools {
      maven 'MVN_HOME'
    }
	
	environment {
        // Define the credential ID and the variable names
        DOCKER_CREDENTIALS = credentials('docker-hub-pass')
    }

stages{
    stage('Maven Build') {
        steps {
            echo 'Trigger a maven build'
            sh "mvn clean package"
        }
    }
       
    stage('Docker Build'){
        steps{
            echo 'Build ernestefrei/devopsproject'
            sh "docker build -t ernestefrei/devopsproject . "
        }
    }
        
    stage('DockerHub Push'){
        steps{
            echo 'Login to Docker-Hub with docker-hub-pass credentials'
            sh "docker login -u ${DOCKER_CREDENTIALS_USR} -p ${DOCKER_CREDENTIALS_PSW}"

            echo 'Push Docker image to Docker Hub'
            sh "docker push ernestefrei/devopsproject:latest"
        }
    }
  
    stage('Docker Deploy'){
            steps{
                echo 'Deploy Docker'
                //sh "ansible-playbook deploy-docker.yml --extra-vars "ansible_ssh_user=root ansible_ssh_pass=toor""
                ansiblePlaybook credentialsId: 'ansible', inventory: 'dev.inv', playbook: 'deploy-docker.yml'     
    }
    
}
}
